!function(){"use strict";angular.module("dndLists",[]).directive("dndDraggable",["$parse","$timeout","dndDropEffectWorkaround","dndDragTypeWorkaround",function(a,b,c,d){return function(e,f,g){f.attr("draggable","true"),g.dndDisableIf&&e.$watch(g.dndDisableIf,function(a){f.attr("draggable",!a)}),f.on("dragstart",function(h){h=h.originalEvent||h,h.dataTransfer.setData("Text",angular.toJson(e.$eval(g.dndDraggable))),h.dataTransfer.effectAllowed=g.dndEffectAllowed||"move",f.addClass("dndDragging"),b(function(){f.addClass("dndDraggingSource")},0),c.dropEffect="none",d.isDragging=!0,d.dragType=g.dndType?e.$eval(g.dndType):void 0,a(g.dndDragstart)(e,{event:h}),h.stopPropagation()}),f.on("dragend",function(b){b=b.originalEvent||b;var h=c.dropEffect;e.$apply(function(){switch(h){case"move":a(g.dndMoved)(e,{event:b});break;case"copy":a(g.dndCopied)(e,{event:b})}}),f.removeClass("dndDragging"),f.removeClass("dndDraggingSource"),d.isDragging=!1,b.stopPropagation()}),f.on("click",function(b){b=b.originalEvent||b,e.$apply(function(){a(g.dndSelected)(e,{event:b})}),b.stopPropagation()}),f.on("selectstart",function(){return this.dragDrop&&this.dragDrop(),!1})}}]).directive("dndList",["$parse","$timeout","dndDropEffectWorkaround","dndDragTypeWorkaround",function(a,b,c,d){return function(e,f,g){function m(a,b,c){var d=k?a.offsetX||a.layerX:a.offsetY||a.layerY,e=k?b.offsetWidth:b.offsetHeight,f=k?b.offsetLeft:b.offsetTop;return f=c?f:0,f+e/2>d}function n(){return Array.prototype.indexOf.call(j.children,i)}function o(a){if(!d.isDragging&&!l)return!1;if(!r(a.dataTransfer.types))return!1;if(g.dndAllowedTypes&&d.isDragging){var b=e.$eval(g.dndAllowedTypes);if(angular.isArray(b)&&-1===b.indexOf(d.dragType))return!1}return g.dndDisableIf&&e.$eval(g.dndDisableIf)?!1:!0}function p(){return h.remove(),f.removeClass("dndDragover"),!0}function q(b,c,f){return a(b)(e,{event:c,index:n(),item:f||void 0,external:!d.isDragging,type:d.isDragging?d.dragType:void 0})}function r(a){if(!a)return!0;for(var b=0;b<a.length;b++)if("Text"===a[b]||"text/plain"===a[b])return!0;return!1}var h=angular.element('<li class="dndPlaceholder"></li>'),i=h[0],j=f[0],k=g.dndHorizontalList&&e.$eval(g.dndHorizontalList),l=g.dndExternalSources&&e.$eval(g.dndExternalSources);f.on("dragover",function(a){if(a=a.originalEvent||a,!o(a))return!0;if(i.parentNode!=j&&f.append(h),a.target!==j){for(var b=a.target;b.parentNode!==j&&b.parentNode;)b=b.parentNode;b.parentNode===j&&b!==i&&(m(a,b)?j.insertBefore(i,b):j.insertBefore(i,b.nextSibling))}else if(m(a,i,!0))for(;i.previousElementSibling&&(m(a,i.previousElementSibling,!0)||0===i.previousElementSibling.offsetHeight);)j.insertBefore(i,i.previousElementSibling);else for(;i.nextElementSibling&&!m(a,i.nextElementSibling,!0);)j.insertBefore(i,i.nextElementSibling.nextElementSibling);return g.dndDragover&&!q(g.dndDragover,a)?p():(f.addClass("dndDragover"),a.preventDefault(),a.stopPropagation(),!1)}),f.on("drop",function(a){if(a=a.originalEvent||a,!o(a))return!0;a.preventDefault();var d,b=a.dataTransfer.getData("Text")||a.dataTransfer.getData("text/plain");try{d=JSON.parse(b)}catch(f){return p()}if(g.dndDrop&&(d=q(g.dndDrop,a,d),!d))return p();var h=e.$eval(g.dndList);return e.$apply(function(){h.splice(n(),0,d)}),c.dropEffect="none"===a.dataTransfer.dropEffect?"copy"===a.dataTransfer.effectAllowed||"move"===a.dataTransfer.effectAllowed?a.dataTransfer.effectAllowed:a.ctrlKey?"copy":"move":a.dataTransfer.dropEffect,p(),a.stopPropagation(),!1}),f.on("dragleave",function(a){a=a.originalEvent||a,f.removeClass("dndDragover"),b(function(){f.hasClass("dndDragover")||h.remove()},100)})}}]).factory("dndDragTypeWorkaround",function(){return{}}).factory("dndDropEffectWorkaround",function(){return{}})}();